<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Headless Raspberry Pi - a&hairsp;j&hairsp;la.ng | blog</title> <link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/blog/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/blog/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/blog/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Headless Raspberry Pi | a&amp;hairsp;j&amp;hairsp;la.ng blog</title> <meta name="generator" content="Jekyll v4.2.1" /> <meta property="og:title" content="Headless Raspberry Pi" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <link rel="canonical" href="/blog/headless-raspberry-pi.html" /> <meta property="og:url" content="/blog/headless-raspberry-pi.html" /> <meta property="og:site_name" content="a&amp;hairsp;j&amp;hairsp;la.ng blog" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Headless Raspberry Pi" /> <script type="application/ld+json"> {"description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","@type":"WebPage","url":"/blog/headless-raspberry-pi.html","headline":"Headless Raspberry Pi","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/blog/" class="site-title lh-tight"> a&hairsp;j&hairsp;la.ng | blog </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/blog/cloudfront-invalidation.html" class="nav-list-link">CloudFront Invalidation</a></li><li class="nav-list-item"><a href="/blog/explicit-versioning.html" class="nav-list-link">Explicit Versioning</a></li><li class="nav-list-item"><a href="/blog/exponential-linear-intersection/" class="nav-list-link">Exponential Linear Intersection</a></li><li class="nav-list-item active"><a href="/blog/headless-raspberry-pi.html" class="nav-list-link active">Headless Raspberry Pi</a></li><li class="nav-list-item"><a href="/blog/outbound-link-warnings.html" class="nav-list-link">Outbound Link Warnings</a></li><li class="nav-list-item"><a href="/blog/student-loan-calculator/" class="nav-list-link">Student Loan Calculator</a></li><li class="nav-list-item"><a href="/blog/uk-house-prices/" class="nav-list-link">UK House Prices</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search a&hairsp;j&hairsp;la.ng | blog" aria-label="Search a&hairsp;j&hairsp;la.ng | blog" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 id="headless-raspberry-pi-setup"> <a href="#headless-raspberry-pi-setup" class="anchor-heading" aria-labelledby="headless-raspberry-pi-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Headless Raspberry Pi Setup </h1> <p>First we need grab ourselves an <a href="https://www.raspberrypi.com/software/operating-systems/">OS image</a>.</p> <p>While that’s downloading, we can list the attached drives before and after inserting our SD card, to find it’s device name.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; lsblk -p
NAME                            MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT
/dev/mmcblk0                    179:0    0  14.9G  0 disk
└─/dev/mmcblk0p1                179:1    0  14.9G  0 part  /media/aaron/9016-4EF8
</code></pre></div></div> <p>Once the image is downloaded, we can decompress it and write it to the SD card.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unzip ~/Downloads/2022-01-28-raspios-bullseye-armhf-lite.zip
sudo dd if=./2022-01-28-raspios-bullseye-armhf-lite.img \
  of=/dev/mmcblk0 bs=4M conv=fsync status=progress
</code></pre></div></div> <p>This might take a minute or two. <code class="language-plaintext highlighter-rouge">-p</code> pipes the contents to stdout rather than disk, and <code class="language-plaintext highlighter-rouge">fsync</code> ensure dd flushes writes to the SD card on completion.</p> <p>After it’s finished, we can remove and re-insert the card to see the new partitions.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; lsblk
NAME                MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT
mmcblk0             179:0    0  14.9G  0 disk
├─mmcblk0p1         179:1    0   256M  0 part  /media/aaron/boot
└─mmcblk0p2         179:2    0   1.6G  0 part  /media/aaron/rootfs
</code></pre></div></div> <p>My OS has handily mounted this for me, you may have to do that manually.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; cd /media/aaron
&gt; ls
boot
rootfs
</code></pre></div></div> <p>To enable <code class="language-plaintext highlighter-rouge">ssh</code> on boot we can create the below empty file.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; touch boot/ssh
</code></pre></div></div> <p>And configure the WiFi connection.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; vim boot/wpa_supplicant.conf
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
country=&lt;Insert 2 letter ISO 3166-1 country code here&gt;
update_config=1

network={
 ssid="&lt;Name of your wireless LAN&gt;"
 psk="&lt;Password for your wireless LAN&gt;"
}
</code></pre></div></div> <p>Note that you are writing your WiFi password in plaintext on an unencrypted filesystem, so don’t leave this pi anywhere bad actors might have physical access.</p> <p>If you want to add multiple networks add <code class="language-plaintext highlighter-rouge">id_str</code> with a unique name like</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
country=&lt;Insert 2 letter ISO 3166-1 country code here&gt;
update_config=1

network={
 ssid="&lt;Name of your wireless LAN&gt;"
 psk="&lt;Password for your wireless LAN&gt;"
 id_str="Home_2.4GHz"
}

network={
 ssid="&lt;Name of your wireless LAN&gt;"
 psk="&lt;Password for your wireless LAN&gt;"
 id_str="Home_5GHz"
}
</code></pre></div></div> <p>We want our pi to have a predictable IP. This can be done though DHCP reservation if your router supports it, but raspberry pis have a habit of randomising their MAC address which makes that tricky.</p> <p>A more reliable solution is to assign a static IP address on the pi itself. Check your router settings to ensure you pick an IP address that won’t be assigned to another device via DHCP.</p> <p>Pick a hostname and IP address. You can get inspiration from any ordered set, chemical elements, roman emporors, I usualy use pokemon.</p> <p>This device will be named zenigame and have IP address 192.168.1.7 .</p> <p>Open <code class="language-plaintext highlighter-rouge">rootfs/etc/dhcpcd.conf</code> and append to the end the following lines. Your router address may vary, try <code class="language-plaintext highlighter-rouge">sudo arp-scan --localnet</code> if you’re not sure.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>static ip_address=192.168.1.7/24
static routers=192.168.1.254
static domain_name_servers=192.168.1.254
</code></pre></div></div> <p>Note that this sets the same IP address for both the WiFi and ethernet interfaces, so you may not be able to use both at once.</p> <p>To set the hostname, edit <code class="language-plaintext highlighter-rouge">rootfs/etc/hostname</code> and <code class="language-plaintext highlighter-rouge">rootfs/etc/hosts</code> and change the default <code class="language-plaintext highlighter-rouge">raspberrypi</code> to your chosen name, I’m using zenigame.</p> <p>I also like to customise <code class="language-plaintext highlighter-rouge">rootfs/etc/motd</code> with some ascii art, I’m going to be using <a href="http://www.fiikus.net/asciiart/pokemon/007.txt">this</a> by <a href="http://www.fiikus.net/?pokedex">Maija Haavisto</a>.</p> <p>This is about as far as we can get with the pi offline, so let’s unmount the SD card and power up our pi.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; sudo umount boot
&gt; sudo umount rootfs
</code></pre></div></div> <h2 id="pi-online"> <a href="#pi-online" class="anchor-heading" aria-labelledby="pi-online"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pi Online </h2> <p>The only indication we get from the pi directly is the power LED, but we can run <code class="language-plaintext highlighter-rouge">arp-scan</code> and wait for it’s IP to show up.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; sudo arp-scan --localnet
192.168.1.7	dc:a6:32:a4:ad:bb	Raspberry Pi Trading Ltd
</code></pre></div></div> <p>We can add an entry to our <code class="language-plaintext highlighter-rouge">.ssh/config</code> like below</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Host zenigame
  Hostname 192.168.0.9
  User pi
</code></pre></div></div> <p>and attempt to connect with the default password ‘raspberry’</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh zenigame
</code></pre></div></div> <p>Press ctrl-d to logout.</p> <p>Assuming you have your ssh keys setup locally you can run</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-copy-id zenigame
</code></pre></div></div> <p>Once complete you should be able to run <code class="language-plaintext highlighter-rouge">ssh zenigame</code> without being asked for a password.</p> <p>Now we’re not at risk of locking ourselves out we can change the password. We won’t be using it much so I’d suggest making it random and keeping it in a password manager.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pi&gt; passwd
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">vim</code> is not installed by default, only <code class="language-plaintext highlighter-rouge">vi</code>. You may wish to install vim or simply alias to vi.</p> <p>Let’s update the system, which will also test our network connection.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pi&gt; sudo apt update
pi&gt; sudo apt upgrade
</code></pre></div></div> <p>Let’s also set up the system to automatically install it’s own security updates.</p> <p>(Reference: https://wiki.debian.org/UnattendedUpgrades)</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install unattended-upgrades apt-listchanges
</code></pre></div></div> <p>In</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/apt/apt.conf.d/50unattended-upgrades
</code></pre></div></div> <p>uncomment and set</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Unattended-Upgrade::Mail "root";
</code></pre></div></div> <p>How to check this? Install web mail? Dump in bash cgi? Set up forward to my email address? You can read [this] article to see how to read this mail.</p> <p>Some suggest that we need to also edit the sources in that config file, some do not. I’ll leave it as default for now and monitor. https://raspberrypi.stackexchange.com/questions/38931/how-do-i-set-my-raspberry-pi-to-automatically-update-upgrade</p> <p>You can monitor these files to check on the automation</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/log/unattended-upgrades/unattended-upgrades.log
/var/log/unattended-upgrades/unattended-upgrades-dpkg.log
/var/log/dpkg.log
/var/log/apt/history.log
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
