<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Explicit Versioning - a&hairsp;j&hairsp;la.ng | blog</title> <link rel="shortcut icon" href="/blog/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/blog/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/blog/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/blog/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Explicit Versioning | a&amp;hairsp;j&amp;hairsp;la.ng blog</title> <meta name="generator" content="Jekyll v4.2.1" /> <meta property="og:title" content="Explicit Versioning" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." /> <link rel="canonical" href="/blog/explicit-versioning.html" /> <meta property="og:url" content="/blog/explicit-versioning.html" /> <meta property="og:site_name" content="a&amp;hairsp;j&amp;hairsp;la.ng blog" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Explicit Versioning" /> <script type="application/ld+json"> {"description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","@type":"WebPage","url":"/blog/explicit-versioning.html","headline":"Explicit Versioning","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/blog/" class="site-title lh-tight"> a&hairsp;j&hairsp;la.ng | blog </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/blog/aws-mfa-cli.html" class="nav-list-link">AWS MFA CLI</a></li><li class="nav-list-item"><a href="/blog/cloudfront-invalidation.html" class="nav-list-link">CloudFront Invalidation</a></li><li class="nav-list-item active"><a href="/blog/explicit-versioning.html" class="nav-list-link active">Explicit Versioning</a></li><li class="nav-list-item"><a href="/blog/exponential-linear-intersection/" class="nav-list-link">Exponential Linear Intersection</a></li><li class="nav-list-item"><a href="/blog/headless-raspberry-pi.html" class="nav-list-link">Headless Raspberry Pi</a></li><li class="nav-list-item"><a href="/blog/outbound-link-warnings.html" class="nav-list-link">Outbound Link Warnings</a></li><li class="nav-list-item"><a href="/blog/self-documenting-micro-servers/" class="nav-list-link">Self-Documenting Micro-Servers</a></li><li class="nav-list-item"><a href="/blog/student-loan-calculator/" class="nav-list-link">Student Loan Calculator</a></li><li class="nav-list-item"><a href="/blog/uk-house-prices/" class="nav-list-link">UK House Prices</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search a&hairsp;j&hairsp;la.ng | blog" aria-label="Search a&hairsp;j&hairsp;la.ng | blog" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 id="explicit-versioning"> <a href="#explicit-versioning" class="anchor-heading" aria-labelledby="explicit-versioning"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Explicit Versioning </h1> <p>Versioning is an important part of software development, but simply having a version number isn’t much use if your users can’t access it.</p> <p>In almost every piece of software you’ve installed there’ll be an “About” menu with details on which version of the software you have. Debugging issues if far easier if you know which version of your software has the bug.</p> <p>Visible version information is also important (although less common) for software presented as a service, such as a web application. Both web sites and APIs benefit from user-facing versioning, whether it’s during internal testing or in production.</p> <p>Sometimes, knowing when an issue occured can narrow down the version that caused it. This isn’t a robust solution however, espicially if the bug report doesn’t specify a timezone. Caching issues can mean the user may not be experiencing the version that’s officially been deployed, and <a href="https://wa.aws.amazon.com/wat.concept.canary-deployment.en.html">canary deployments</a> mean you could have multiple versions live at the same time and no way to know which the user is seeing.</p> <p>Explicit versioning is also useful during development and testing, allowing developers, testers, project managers and operations to see what version is available in which environment in real time so that issue can be better reported, more easily reproduced and tested, and more swiftly resolved.</p> <p>Giving operational staff a way to check what version is live is also a quick and easy smoke test after any deployment.</p> <p>One way to acheive this is to include the below script as an early part of your build process. It produces a <code class="language-plaintext highlighter-rouge">json</code> file which can easily be imported/read/compiled during the build, and the data used to display the version at runtime.</p> <p>You can use the build information to display a version on the login screen and/or subtley in the footer. If you choose to only display some of the information, you can make the rest available as a tool-tip or via <code class="language-plaintext highlighter-rouge">console.log</code>. Or if you’re building an API you can expose a <code class="language-plaintext highlighter-rouge">GET /version</code> endpoint that returns the <code class="language-plaintext highlighter-rouge">json</code> as-is.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#! /bin/sh</span>
<span class="nb">set</span> <span class="nt">-eu</span>

<span class="c">#   This file should be saved as scripts/build-info.sh or similar, and</span>
<span class="c"># run early in the build process to allow other code to import/read/link</span>
<span class="c"># the generated file and make the information available to the end user.</span>

<span class="c">#   If the version you are building is tagged the tag will be used,</span>
<span class="c"># like "v1.4.3"</span>
<span class="c">#   If the version you are building is not tagged the previous tag will</span>
<span class="c"># be used and the number of commits since the last tag and the hash of</span>
<span class="c"># the current commit will be appended, like "v1.4.3-20-g1a5ef12"</span>
<span class="c">#   If you have uncommitted changes, such as during development, "dirty"</span>
<span class="c"># will be appended like "v1.4.3-dirty"</span>
<span class="c">#   If you have not yet created any tags you will get the error</span>
<span class="c"># "fatal: No names found, cannot describe anything". If needed you can</span>
<span class="c"># tag your root commit v0.0.0</span>
<span class="nv">version</span><span class="o">=</span><span class="si">$(</span>git describe <span class="nt">--dirty</span> <span class="nt">--tags</span><span class="si">)</span>

<span class="c">#   This is an ISO-8601 timestamp which can be easily interpreted by</span>
<span class="c"># humans and most computer systems. The format is given explicity here</span>
<span class="c"># to be compatible with mac and linux</span>
<span class="nv">when</span><span class="o">=</span><span class="si">$(</span><span class="nb">date</span> +%Y-%m-%dT%H:%M:%S%z<span class="si">)</span>

<span class="c">#   The name of the current user account. It can be useful to know if</span>
<span class="c"># the build was created manually/locally or by an automated system.</span>
<span class="nb">who</span><span class="o">=</span><span class="k">${</span><span class="nv">USER</span><span class="p">-</span><span class="k">}</span>

<span class="c"># You should add build-info.json to your .gitignore</span>

<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; build-info.json
{
  "version": "</span><span class="nv">$version</span><span class="sh">",
  "when": "</span><span class="nv">$when</span><span class="sh">",
  "who": "</span><span class="nv">$who</span><span class="sh">"
}
</span><span class="no">EOF
</span></code></pre></div></div> <p>Recording versions elsewhere such as <code class="language-plaintext highlighter-rouge">package.json</code> can be useful if you’re distributing a library for example, but the above script provides continous, automatic and specific version information during development and for systems which are continously deployed.</p> <p>An example react component:</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">buildInfo</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../build-info.json</span><span class="dl">'</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">Footer</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>
      Copyright <span class="si">{</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toLocaleDateString</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span> <span class="na">year</span><span class="p">:</span> <span class="dl">'</span><span class="s1">numeric</span><span class="dl">'</span><span class="p">})</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">style</span><span class="p">=</span><span class="si">{</span><span class="p">{</span> <span class="na">textAlign</span><span class="p">:</span> <span class="dl">'</span><span class="s1">right</span><span class="dl">'</span> <span class="p">}</span><span class="si">}</span> <span class="na">title</span><span class="p">=</span><span class="si">{</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">buildInfo</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="p">&gt;</span>
      <span class="si">{</span><span class="nx">buildInfo</span><span class="p">.</span><span class="nx">version</span><span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>An example express route:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">buildInfo</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../build-info.json</span><span class="dl">'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/build-info</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">buildInfo</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">})</span>
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
